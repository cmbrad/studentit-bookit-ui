<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icons/hardware-icons.html">

<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="location-card">
	<template>
		<style>
			:host {
				display: inline-block;
				box-sizing: border-box;
				margin: 0 3px 0 3px;
				--paper-card-header-color: white;
				--paper-card-header-text: {
					cursor: default;
				}
			}
			
			.card-content {
				display: flex;
				align-items: center;
				justify-content: center;
			}
			
			.free-pip {
				background: #f00;
				width: 50px;
				height: 30px;
				border-radius: 25%;
				color: white;
				display: flex;
				align-items: center;
				justify-content: center;
			}
			
			.computer-pip {
				background-color: #ff4081;
			}
			
			.room-pip {
				background-color: #ff4081;
			}
			
			paper-card {
				width: 100%;
			}
		</style>

		<paper-card heading="[[heading]]" image="[[image]]" elevation="1" animated-shadow="true">
			<div class="card-content">
				<paper-icon-button icon="hardware:desktop-windows"></paper-icon-button>
				<div class="free-pip computer-pip">[[availableComputers]]</div>
				<paper-icon-button icon="icons:home"></paper-icon-button>
				<div class="free-pip room-pip">[[availableRooms]]</div>
			</div>
		</paper-card>
	</template>
	<script>
        Polymer({
            is: 'location-card',

            ready: function() {
                this._setCardSize();

                window.addEventListener('resize', function(e) {
                    this._setCardSize();
                }.bind(this));
            },

            properties: {
                heading: {
                    type: String
                },
                image: {
                    type: String
                },
                availableComputers: {
                    type: Number
                },
                availableRooms: {
                    type: Number
                },
                wide: {
                    type: Boolean,
                    observer: '_wideChanged'
                },
                paddingCollapsed: {
                    type: Boolean
                }
            },

            _setCardSize: function() {
                var width = 220;
                var height = 160;

                var outerPadding = this.paddingCollapsed ? 12 : 96;
                // Add 6 for margin between cards
                var extra = this.calcCardSize(window.innerWidth, outerPadding, width + 6);
                console.log(extra);
                var totalWidth = width + extra;
                var totalHeight = height;
                
                this.style.width = 'auto';
                this.customStyle['--paper-card-header-image'] = 'width: ' + String(totalWidth) + 'px; height: ' + String(totalHeight) + 'px; filter: brightness(60%);';

                this.updateStyles();
            },

            calcCardSize: function(windowWidth, outerPadding, cardWidth) {
                var availableSpace = windowWidth - outerPadding;
                var cardsPerRow = Math.floor(availableSpace / cardWidth);
                var emptySpace = availableSpace % cardWidth;

                return Math.floor(emptySpace / cardsPerRow);
            }
        });
    </script>
</dom-module>